---
title: 搬瓦工VPS搭建SS服务器
date: 2018-04-01
updated: 2019-01-06 11:58:40
categories:
- [操作系统]
tags: [CentOS, Linux]
---

### 目录

* [系统环境准备](#系统环境准备)
* [安装ShadowSocks](#安装shadowsocks)

#### 系统环境准备

&emsp;&emsp;搬瓦工默认给我安装的是CentOS6_X86 bbr，于是第一件事就是果断重新安装成CentOS7。所有VPS的设置都在KiwiVM的控制台里面。

&emsp;&emsp;重新安装好系统之后第一件事就是修改root用户的密码，避免弱口令。然后新建一个普通用户并为它配置sudo权限。

```bash
adduser username
passwd username
vi sudo # 在配置中添加一行: username  ALL=(ALL)  NOPASSWD: ALL
```

&emsp;&emsp;由于是开放在外网，当然要配置防火墙

```bash
yum install firewalld -y
```

&emsp;&emsp;防火墙根据需要来配置

```bash
firewall-cmd --zone=public --remove-service=ssh # 用其它端口连接ssh，移除默认的
firewall-cmd --zone=public --add-port=12345/tcp # 允许SSH
firewall-cmd --zone=public --add-port=54321/tcp # 允许ShadowSock
```

&emsp;&emsp;这些琐事完成之后就可以切换到普通用户来安装Python了。

```bash
yum install wget git gcc gcc-c++ zlib zlib-devel openssl-devel -y
wget https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tgz
tar xf Python-3.6.5.tgz
cd Python-3.6.5
vi Modules/Setup # 搜索关键字 zlib 和 ssl 去掉zlib和ssl依赖的注释
./configure --prefix=/usr/local/python36 --enable-optimizations
make && make install
rm -rf /usr/bin/python # 删掉默认的Python链接修改成Python3
ln -s /usr/local/python/bin/python3.6 /usr/bin/python
ln -s /usr/local/python/bin/python3.6 /usr/bin/python3
ln -s /usr/local/python36/bin/pip3 /usr/bin/pip
```

&emsp;&emsp;由于上面将系统默认的python链接改成了Python3，yum、firewalld等组件会无法运行,修改下面几个文件可以解决

* /usr/libexec/urlgrabber-ext-down
* /usr/bin/yum
* /usr/bin/firewall-cmd
* /usr/bin/firewall-offline-cmd
* /usr/sbin/firewalld

首行usr/bin/python 修改为 /usr/bin/python2

#### 安装ShadowSocks

http://cache.baiducontent.com/c?m=9f65cb4a8c8507ed19fa950d100b8d354816d3382bd7a744228b8e1bd32200101931feb821291305d9c57d670aae495efeb56b32610c64f5dadf893acacb943f58ff3044060bf54b05d269ee8a&p=8b2a970c939550f708e2947d095695&newp=8b2a970689970eff57ed977a52078f231610db2151d4d7116b82c825d7331b001c3bbfb423251101d8c376630baf435ae9f63c79310523a3dda5c91d9fb4c57479cb78603f&user=baidu&fm=sc&query=vps%B4%EE%BD%A8ss&qid=d36f268b00033903&p1=2